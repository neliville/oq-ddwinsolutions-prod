{% extends 'base.html.twig' %}

{% block title %}Blog Qualité | Articles et Guides{% endblock %}

{% block meta_description %}Découvrez nos articles sur l'amélioration continue, les méthodes qualité et les outils d'analyse. Guides pratiques et conseils d'experts.{% endblock %}

{% block meta_keywords %}blog qualité, amélioration continue, méthodes qualité, outils d'analyse, guides pratiques, conseils experts, ISO 9001, Lean, Kaizen{% endblock %}

{% block og_title %}Blog Qualité | Articles et Guides | OUTILS-QUALITÉ{% endblock %}

{% block og_description %}Découvrez nos articles sur l'amélioration continue, les méthodes qualité et les outils d'analyse. Guides pratiques et conseils d'experts.{% endblock %}

{% block body %}
<!-- Hero Section -->
<section class="py-5 bg-gradient-primary text-black" style="margin-top: 76px;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8" data-aos="fade-right">
                <h1 class="display-4 fw-bold mb-4">Blog Qualité</h1>
                <p class="lead mb-4">
                    Découvrez nos articles, guides pratiques et conseils d'experts pour maîtriser
                    les outils d'amélioration continue et optimiser vos processus qualité.
                </p>
            </div>
            <div class="col-lg-4" data-aos="fade-left">
                {% include 'components/media/responsive_picture.html.twig' with {
                    path: 'img/blog-5why.webp',
                    alt: 'Blog qualité',
                    width: 900,
                    height: 600
                } %}
            </div>
        </div>
    </div>
</section>

<!-- Category Filters -->
{% if categories|length > 0 %}
<section class="py-4 bg-light">
    <div class="container">
        <div class="d-flex flex-wrap justify-content-center gap-2" data-aos="fade-up">
            <a href="{{ path('app_blog_index') }}" 
               class="btn {% if not currentCategory %}btn-primary{% else %}btn-outline-primary{% endif %}">
                <i class="fas fa-th-large me-2"></i>Tous les articles
            </a>
            {% for category in categories %}
            <a href="{{ path('app_blog_index', {category: category.slug}) }}" 
               class="btn {% if currentCategory == category.slug %}btn-primary{% else %}btn-outline-primary{% endif %}">
                {% if category.icon %}<i class="fas fa-{{ category.icon }} me-2"></i>{% endif %}
                {{ category.name }}
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Featured Articles -->
{% if featuredPosts|length > 0 %}
<section class="py-5 bg-primary bg-opacity-10">
    <div class="container">
        <h2 class="h3 fw-bold mb-4">Articles mis en avant</h2>
        <div class="row g-4">
            {% for featuredPost in featuredPosts %}
            <div class="col-md-4" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
                <div class="card border-0 shadow-sm h-100">
                    {% if featuredPost.image %}
                        {% include 'components/media/responsive_picture.html.twig' with {
                            path: featuredPost.image,
                            alt: featuredPost.title,
                            class: 'card-img-top',
                            width: 400,
                            height: 300
                        } %}
                    {% endif %}
                    <div class="card-body p-4">
                        {% if featuredPost.category %}
                        <span class="badge bg-{{ featuredPost.category.color|default('primary') }} mb-2">{{ featuredPost.category.name }}</span>
                        {% endif %}
                        <h5 class="fw-bold mb-2">
                            <a href="{{ path('app_blog_article', {category: featuredPost.category.slug, slug: featuredPost.slug}) }}" 
                               class="text-decoration-none text-dark">
                                {{ featuredPost.title }}
                            </a>
                        </h5>
                        <p class="text-muted small mb-3">{{ featuredPost.excerpt|striptags|slice(0, 120) }}...</p>
                        <div class="d-flex align-items-center justify-content-between">
                            <small class="text-muted">{{ featuredPost.readTime }}</small>
                            <a href="{{ path('app_blog_article', {category: featuredPost.category.slug, slug: featuredPost.slug}) }}" 
                               class="btn btn-sm btn-outline-primary">
                                Lire la suite
                                <i data-lucide="arrow-right" width="14" height="14" class="ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Articles Section -->
<section class="py-5">
    <div class="container">
        {% if blogPosts|length > 0 %}
        <div class="row g-4 mb-5">
            {% for post in blogPosts %}
            <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 50 }}">
                <div class="card border-0 shadow-sm h-100">
                    {% if post.image %}
                        {% include 'components/media/responsive_picture.html.twig' with {
                            path: post.image,
                            alt: post.title,
                            class: 'card-img-top',
                            width: 400,
                            height: 300
                        } %}
                    {% endif %}
                    <div class="card-body p-4">
                        <div class="d-flex align-items-start mb-3">
                            {% if post.category %}
                            <span class="badge bg-{{ post.category.color|default('primary') }} me-2">{{ post.category.name }}</span>
                            {% endif %}
                            <small class="text-muted ms-auto">{{ post.publishedAt|date('d/m/Y') }}</small>
                        </div>
                        <h5 class="fw-bold mb-2">
                            <a href="{{ path('app_blog_article', {category: post.category.slug, slug: post.slug}) }}" 
                               class="text-decoration-none text-dark">
                                {{ post.title }}
                            </a>
                        </h5>
                        <p class="text-muted small mb-3">{{ post.excerpt|striptags|slice(0, 100) }}...</p>
                        <div class="d-flex align-items-center justify-content-between">
                            <small class="text-muted">
                                {{ post.readTime }}
                                {% if post.views > 0 %}
                                • <i data-lucide="eye" width="12" height="12" class="me-1"></i>{{ post.views }}
                                {% endif %}
                            </small>
                            <a href="{{ path('app_blog_article', {category: post.category.slug, slug: post.slug}) }}" 
                               class="btn btn-sm btn-outline-primary">
                                Lire
                                <i data-lucide="arrow-right" width="12" height="12" class="ms-1"></i>
                            </a>
                        </div>
                        {% if post.tags|length > 0 %}
                        <div class="mt-3 pt-3 border-top">
                            <div class="d-flex flex-wrap gap-1">
                                {% for tag in post.tags|slice(0, 3) %}
                                <span class="badge bg-light text-dark small">{{ tag.name }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if totalPages > 1 %}
        <nav aria-label="Pagination des articles">
            <ul class="pagination justify-content-center">
                {% if currentPage > 1 %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('app_blog_index', {category: currentCategory, page: currentPage - 1}) }}">
                        <i data-lucide="chevron-left" width="16" height="16"></i>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">
                        <i data-lucide="chevron-left" width="16" height="16"></i>
                    </span>
                </li>
                {% endif %}

                {% for page in 1..totalPages %}
                {% if page == currentPage %}
                <li class="page-item active">
                    <span class="page-link">{{ page }}</span>
                </li>
                {% elseif page == 1 or page == totalPages or (page >= currentPage - 2 and page <= currentPage + 2) %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('app_blog_index', {category: currentCategory, page: page}) }}">{{ page }}</a>
                </li>
                {% elseif page == currentPage - 3 or page == currentPage + 3 %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
                {% endif %}
                {% endfor %}

                {% if currentPage < totalPages %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('app_blog_index', {category: currentCategory, page: currentPage + 1}) }}">
                        <i data-lucide="chevron-right" width="16" height="16"></i>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">
                        <i data-lucide="chevron-right" width="16" height="16"></i>
                    </span>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        {% else %}
        <!-- Message si aucun article -->
        <div class="text-center py-5">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-5">
                    <i data-lucide="file-text" width="64" height="64" class="text-muted mb-3"></i>
                    <h4 class="text-muted">Aucun article trouvé</h4>
                    <p class="text-muted">Aucun article publié pour le moment. Revenez bientôt !</p>
                    {% if currentCategory %}
                    <a href="{{ path('app_blog_index') }}" class="btn btn-primary mt-3">
                        Voir tous les articles
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Most Viewed Articles -->
{% if mostViewedPosts|length > 0 %}
<section class="py-5 bg-light">
    <div class="container">
        <h2 class="h3 fw-bold mb-4">Articles les plus lus</h2>
        <div class="row g-4">
            {% for post in mostViewedPosts %}
            <div class="col-md-6" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
                <div class="card border-0 shadow-sm">
                    {% if post.image %}
                    <img src="{{ asset(post.image) }}" class="card-img-top" alt="{{ post.title }}" loading="lazy">
                    {% endif %}
                    <div class="card-body p-4">
                        <div class="d-flex align-items-start mb-3">
                            {% if post.category %}
                            <span class="badge bg-{{ post.category.color|default('primary') }} me-2">{{ post.category.name }}</span>
                            {% endif %}
                            <small class="text-muted ms-auto">
                                <i data-lucide="eye" width="12" height="12" class="me-1"></i>{{ post.views }} vues
                            </small>
                        </div>
                        <h5 class="fw-bold mb-2">
                            <a href="{{ path('app_blog_article', {category: post.category.slug, slug: post.slug}) }}" 
                               class="text-decoration-none text-dark">
                                {{ post.title }}
                            </a>
                        </h5>
                        <p class="text-muted small mb-3">{{ post.excerpt|striptags|slice(0, 120) }}...</p>
                        <a href="{{ path('app_blog_article', {category: post.category.slug, slug: post.slug}) }}" 
                           class="btn btn-sm btn-outline-primary">
                            Lire la suite
                            <i data-lucide="arrow-right" width="14" height="14" class="ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Newsletter Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8" data-aos="fade-up">
                {% include 'components/newsletter-form.html.twig' with {'newsletterForm': newsletterForm} %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block stylesheets %}
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
{% endblock %}

{% block javascripts %}
<script>
// Initialize Lucide icons
document.addEventListener('DOMContentLoaded', function() {
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});
</script>
{% endblock %}
