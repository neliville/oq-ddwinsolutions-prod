{% extends 'base_with_sidebar.html.twig' %}

{% block title %}{{ post.title }} | Administration{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <a href="{{ path('app_admin_blog_index') }}" class="btn btn-sm btn-outline-secondary mb-2">
                <i data-lucide="arrow-left" width="16" height="16" class="me-1"></i>
                Retour à la liste
            </a>
            <h1 class="h3 fw-bold mb-1">{{ post.title }}</h1>
            <p class="text-muted mb-0">Aperçu de l'article</p>
        </div>
        <div>
            {% if post.publishedAt %}
            <span class="badge bg-success me-2">Publié</span>
            {% else %}
            <span class="badge bg-warning me-2">Brouillon</span>
            {% endif %}
            {% if post.featured %}
            <span class="badge bg-primary">⭐ Mis en avant</span>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <!-- Contenu de l'article -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <!-- Métadonnées -->
                    <div class="mb-4 pb-4 border-bottom">
                        <div class="d-flex flex-wrap gap-3 align-items-center mb-3">
                            {% if post.category %}
                            <span class="badge" style="background-color: {{ post.category.color }}; color: white; font-size: 0.9rem;">
                                <i data-lucide="{{ post.category.icon }}" width="14" height="14" class="me-1"></i>
                                {{ post.category.name }}
                            </span>
                            {% endif %}
                            {% if post.tags|length > 0 %}
                            {% for tag in post.tags %}
                            <span class="badge bg-secondary">{{ tag.name }}</span>
                            {% endfor %}
                            {% endif %}
                            <small class="text-muted">
                                <i data-lucide="clock" width="14" height="14" class="me-1"></i>
                                {{ post.readTime }}
                            </small>
                            <small class="text-muted">
                                <i data-lucide="eye" width="14" height="14" class="me-1"></i>
                                {{ post.views }} vues
                            </small>
                        </div>
                        <div class="d-flex flex-wrap gap-3 text-muted small">
                            <div>
                                <strong>Créé le:</strong> {{ post.createdAt|date('d/m/Y à H:i') }}
                            </div>
                            {% if post.updatedAt %}
                            <div>
                                <strong>Modifié le:</strong> {{ post.updatedAt|date('d/m/Y à H:i') }}
                            </div>
                            {% endif %}
                            {% if post.publishedAt %}
                            <div>
                                <strong>Publié le:</strong> {{ post.publishedAt|date('d/m/Y à H:i') }}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Extrait -->
                    <div class="mb-4">
                        <h6 class="text-muted text-uppercase small mb-2">Extrait</h6>
                        <p class="lead">{{ post.excerpt }}</p>
                    </div>

                    {% if post.image %}
                    <div class="mb-4">
                        <h6 class="text-muted text-uppercase small mb-2">Image à la une</h6>
                        <img src="{{ (post.image starts with 'http') ? post.image : asset(post.image) }}" alt="{{ post.title }}" class="img-fluid rounded shadow-sm" loading="lazy" width="800" height="450">
                    </div>
                    {% endif %}

                    <!-- Contenu -->
                    <div class="mb-4">
                        <h6 class="text-muted text-uppercase small mb-3">Contenu</h6>
                        <div class="bg-light rounded p-4">
                            {{ post.content|markdown_to_html|raw }}
                        </div>
                    </div>

                    <!-- Slug -->
                    <div class="mb-4">
                        <h6 class="text-muted text-uppercase small mb-2">Slug (URL)</h6>
                        <code class="bg-light p-2 rounded d-block">{{ post.slug }}</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white border-bottom">
                    <h6 class="mb-0">Actions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ path('app_admin_blog_edit', {id: post.id}) }}" class="btn btn-primary">
                            <i data-lucide="edit" width="16" height="16" class="me-1"></i>
                            Modifier l'article
                        </a>
                        {% if post.publishedAt %}
                        <form method="post" action="{{ path('app_admin_blog_unpublish', {id: post.id}) }}" class="d-inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('unpublish_' ~ post.id) }}">
                            <button type="submit" class="btn btn-outline-warning w-100">
                                <i data-lucide="eye-off" width="16" height="16" class="me-1"></i>
                                Dépublier
                            </button>
                        </form>
                        {% else %}
                        <form method="post" action="{{ path('app_admin_blog_publish', {id: post.id}) }}" class="d-inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('publish_' ~ post.id) }}">
                            <button type="submit" class="btn btn-outline-success w-100">
                                <i data-lucide="check" width="16" height="16" class="me-1"></i>
                                Publier
                            </button>
                        </form>
                        {% endif %}
                        <form method="post" action="{{ path('app_admin_blog_delete', {id: post.id}) }}" 
                              class="d-inline"
                              onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet article ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete_' ~ post.id) }}">
                            <button type="submit" class="btn btn-outline-danger w-100">
                                <i data-lucide="trash-2" width="16" height="16" class="me-1"></i>
                                Supprimer
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Statistiques -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h6 class="mb-0">Statistiques</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block">Vues</small>
                        <strong>{{ post.views }}</strong>
                    </div>
                    {% if post.publishedAt %}
                    <div class="mb-3">
                        <small class="text-muted d-block">Jours depuis publication</small>
                        <strong>{{ date().diff(post.publishedAt).days }} jours</strong>
                    </div>
                    {% endif %}
                    <div>
                        <small class="text-muted d-block">Nombre de mots</small>
                        <strong>{{ post.content|split(' ')|length }} mots</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
if (typeof lucide !== 'undefined') {
    lucide.createIcons();
}
</script>
{% endblock %}

