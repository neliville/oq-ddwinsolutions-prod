{# Composant réutilisable pour champ de formulaire accessible #}
{# Usage:
    {% include 'components/form/field.html.twig' with {
        field: registrationForm.email,
        label: 'Adresse email',
        help: 'Nous ne partagerons jamais votre email.',
        icon: 'mail'
    } %}
#}
{% set fieldId = field.vars.id %}
{% set fieldErrors = field.vars.errors %}
{% set hasErrors = fieldErrors|length > 0 %}

<div class="mb-3">
    {# Label #}
    {{ form_label(field, label|default(null), {
        'label_attr': {'class': 'form-label'}
    }) }}

    {# Texte d'aide (optionnel) #}
    {% if help is defined %}
        <div class="form-text" id="{{ fieldId }}-help">
            {{ help }}
        </div>
    {% endif %}

    {# Champ du formulaire avec icône optionnelle #}
    {% if icon is defined %}
        <div class="input-group">
            <span class="input-group-text">
                <i data-lucide="{{ icon }}" width="18" height="18" aria-hidden="true"></i>
            </span>
            {{ form_widget(field, {
                'attr': {
                    'class': 'form-control' ~ (hasErrors ? ' is-invalid' : ''),
                    'aria-required': field.vars.required ? 'true' : 'false',
                    'aria-invalid': hasErrors ? 'true' : 'false',
                    'aria-describedby': (help is defined ? fieldId ~ '-help ' : '') ~ (hasErrors ? fieldId ~ '-error' : '')
                }
            }) }}
        </div>
    {% else %}
        {{ form_widget(field, {
            'attr': {
                'class': 'form-control' ~ (hasErrors ? ' is-invalid' : ''),
                'aria-required': field.vars.required ? 'true' : 'false',
                'aria-invalid': hasErrors ? 'true' : 'false',
                'aria-describedby': (help is defined ? fieldId ~ '-help ' : '') ~ (hasErrors ? fieldId ~ '-error' : '')
            }
        }) }}
    {% endif %}

    {# Erreurs du champ (accessibles) #}
    {% if hasErrors %}
        <div id="{{ fieldId }}-error" class="invalid-feedback d-block" role="alert" aria-live="polite">
            {% for error in fieldErrors %}
                {{ error.message }}
            {% endfor %}
        </div>
    {% endif %}
</div>
