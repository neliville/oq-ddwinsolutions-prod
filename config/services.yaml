# This file is the entry point to configure your services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    app.name: 'OUTILS-QUALITÉ'
    app.email: 'noreply@outils-qualite.com'
    blog_images_directory: '%kernel.project_dir%/public/uploads/blog'
services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    # Menu builders
    App\Menu\Builder\MainMenuBuilder:
        tags:
            - { name: knp_menu.menu_builder, method: createMainMenu, alias: main }

    App\Menu\Builder\AdminMenuBuilder:
        tags:
            - { name: knp_menu.menu_builder, method: createAdminMenu, alias: admin }

    App\Menu\Builder\NavbarMenuBuilder:
        tags:
            - { name: knp_menu.menu_builder, method: createNavbar, alias: app.navbar }

    # Mailer Service
    App\Service\MailerService:
        arguments:
            $appName: '%app.name%'
            $appEmail: '%app.email%'
            $appUrl: '%env(APP_URL)%'

    # Newsletter Service
    App\Service\NewsletterService:
        arguments:
            $mailerService: '@App\Service\MailerService'

    # Brevo sync (Lead → API Brevo contacts). Si BREVO_API_KEY absent, la sync est ignorée.
    App\Lead\Infrastructure\Brevo\BrevoSyncService:
        arguments:
            $brevoApiKey: '%env(default::BREVO_API_KEY)%'

    # Newsletter - Mautic (évite confusion avec App\Service\NewsletterService)
    App\Lead\Controller\NewsletterController:
        arguments:
            $newsletterSubscriberService: '@App\Newsletter\Service\NewsletterSubscriber'

    App\Newsletter\Infrastructure\MauticClient:
        arguments:
            $mauticUrl: '%env(MAUTIC_URL)%'
            $mauticUser: '%env(MAUTIC_USER)%'
            $mauticPassword: '%env(MAUTIC_PASSWORD)%'

    # Download - Clean Architecture bindings
    App\Download\Application\Port\FormSubmissionPort: '@App\Download\Infrastructure\Mautic\MauticFormSubmissionAdapter'
    App\Download\Application\Port\ResourceRegistryPort: '@App\Download\Infrastructure\Resource\ResourceRegistry'
    App\Download\Domain\Repository\DownloadRequestRepositoryInterface: '@App\Download\Infrastructure\Persistence\DoctrineDownloadRequestRepository'

    App\Download\Infrastructure\Mautic\MauticFormSubmissionAdapter:
        arguments:
            $mauticFormBaseUrl: '%env(MAUTIC_URL)%'

    App\Download\Service\DownloadRequestService:
        arguments:
            $mauticFormId: '%env(int:MAUTIC_FORM_DOWNLOAD_5M_ID)%'

    App\Download\Service\DownloadAccessService:
        arguments:
            $downloadsDir: '%kernel.project_dir%/var/downloads'

    App\Download\Controller\DownloadRequestController: ~

    App\Download\Controller\DownloadAuthorizeController:
        arguments:
            $authorizeApiKey: '%env(default:DOWNLOAD_AUTHORIZE_API_KEY:)%'

    App\Download\Controller\DownloadCreateFromMauticController:
        arguments:
            $authorizeApiKey: '%env(default:DOWNLOAD_AUTHORIZE_API_KEY:)%'

    App\Site\Controller\Modele5MController:
        arguments:
            $mauticUrl: '%env(MAUTIC_URL)%'
            $mauticFormDownload5mId: '%env(int:MAUTIC_FORM_DOWNLOAD_5M_ID)%'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones
